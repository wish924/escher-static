var Env={weixin:navigator.userAgent.indexOf("MicroMessenger")>-1,android:/android/i.test(navigator.userAgent.toLowerCase()),ios:/(iphone|ipad|ipod|ios)/i.test(navigator.userAgent.toLowerCase()),ie:navigator.userAgent.match(/MSIE\s([\d.]+)/)||navigator.userAgent.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),isIE:function(){return null!=this.ie},isMobile:function(){return this.android||this.ios},isWeixin:function(){return this.weixin}},Preload={add:function(e,t){var n=document.createElement("link");n.rel="prefetch",n.addEventListener("load",function(){t()},!1),n.href=e,document.body.appendChild(n)}},Pano={camera:null,scene:null,renderer:null,radius:500,distance:250,initVideo:function(e){var t=document.createElement("video");t.loop=!0,t.muted=!0,t.autoplay=!0,t.crossOrigin="",t.src=e;var n=new THREE.VideoTexture(t);n.minFilter=THREE.LinearFilter,n.format=THREE.RGBFormat,Pano.init(n)},initPic:function(e){Pano.isPic=!0;var t=(new THREE.TextureLoader).load(e);t.setCrossOrigin="",Pano.init(t)},init:function(e){var t,n;t=document.getElementById("container"),this.camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,1,1100),this.camera.target=new THREE.Vector3(0,0,0),this.camera.position.z=this.distance,this.orbitControls=new THREE.OrbitControls(this.camera),this.scene=new THREE.Scene;var i=new THREE.SphereBufferGeometry(Pano.radius,60,60);i.scale(-1,1,1);var a=new THREE.MeshBasicMaterial({map:e});n=new THREE.Mesh(i,a),this.scene.add(n),this.renderer=new THREE.WebGLRenderer,this.renderer.setPixelRatio(window.devicePixelRatio),this.renderer.setSize(window.innerWidth,window.innerHeight),t.appendChild(this.renderer.domElement),window.addEventListener("resize",Pano.onWindowResize,!1),Pano.animate()},animate:function(){requestAnimationFrame(Pano.animate),Pano.orbitControls.update(),Pano.render()},render:function(){this.renderer.render(this.scene,this.camera)},onWindowResize:function(){Pano.camera.aspect=window.innerWidth/window.innerHeight,Pano.camera.updateProjectionMatrix(),Pano.renderer.setSize(window.innerWidth,window.innerHeight)}};THREE.OrbitControls=function(e){function t(e){p.theta-=e}function n(e){p.phi-=e}function i(e,t,n,i){var a,r,o,d=e*t+n*i;if(d>.499){o=2*Math.atan2(e,i),a=Math.PI/2,r=0;var c=new THREE.Vector3(a,r,o);return c}if(d<-.499){o=-2*Math.atan2(e,i),a=-Math.PI/2,r=0;var c=new THREE.Vector3(a,r,o);return c}var s=e*e,h=t*t,E=n*n;o=Math.atan2(2*t*i-2*e*n,1-2*h-2*E),a=Math.asin(2*d),r=Math.atan2(2*e*i-2*t*n,1-2*s-2*E);var c=new THREE.Vector3(a,r,o);return c}function a(e){l.set(e.clientX,e.clientY),g.subVectors(l,m),t(4*Math.PI*g.x/window.innerWidth*h.rotateSpeed),n(2*Math.PI*g.y/window.innerHeight*h.rotateSpeed),m.copy(l)}function r(e){m.set(e.touches[0].pageX,e.touches[0].pageY)}function o(e){e.preventDefault(),l.set(e.touches[0].pageX,e.touches[0].pageY),g.subVectors(l,m),t(2*Math.PI*g.x/window.innerWidth*h.rotateSpeed),n(2*Math.PI*g.y/window.innerHeight*h.rotateSpeed),m.copy(l),h.update()}function d(e){}function c(e){h.deviceOrientation=e}function s(e){h.screenOrientation=window.orientation||0}this.object=e,this.target=new THREE.Vector3,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-(1/0),this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.25,this.rotateSpeed=.3,this.deviceOrientation={},this.screenOrientation=0;var h=this,E={type:"change"},u=1e-6,w=new THREE.Spherical,p=new THREE.Spherical,m=new THREE.Vector2,l=new THREE.Vector2,g=new THREE.Vector2,v=function(){var e=new THREE.Vector3(0,0,1),t=new THREE.Euler,n=new THREE.Quaternion,i=new THREE.Quaternion((-Math.sqrt(.5)),0,0,Math.sqrt(.5));return function(a,r,o,d,c){t.set(o,r,-d,"YXZ"),a.setFromEuler(t),a.multiply(i),a.multiply(n.setFromAxisAngle(e,-c))}}();this.update=function(){var a=new THREE.Vector3,r=(new THREE.Quaternion).setFromUnitVectors(e.up,new THREE.Vector3(0,1,0)),o=r.clone().inverse(),d=new THREE.Vector3,c=new THREE.Quaternion,s=0,m=0;return function(e){e=e||{};var l=h.deviceOrientation.alpha?THREE.Math.degToRad(h.deviceOrientation.alpha):0,g=h.deviceOrientation.beta?THREE.Math.degToRad(h.deviceOrientation.beta):0,R=h.deviceOrientation.gamma?THREE.Math.degToRad(h.deviceOrientation.gamma):0,T=h.screenOrientation?THREE.Math.degToRad(h.screenOrientation):0,H=(new THREE.Quaternion).copy(h.object.quaternion);v(H,l,g,R,T);var f=i(H.x,H.y,H.z,H.w);e.init||(t(s-f.z),n(m-f.y)),m=f.y,s=f.z;var M=h.object.position;return a.copy(M).sub(h.target),a.applyQuaternion(r),w.setFromVector3(a),w.theta+=p.theta,w.phi+=p.phi,w.theta=Math.max(h.minAzimuthAngle,Math.min(h.maxAzimuthAngle,w.theta)),w.phi=Math.max(h.minPolarAngle,Math.min(h.maxPolarAngle,w.phi)),w.makeSafe(),a.setFromSpherical(w),a.applyQuaternion(o),M.copy(h.target).add(a),h.object.lookAt(h.target),h.enableDamping===!0?(p.theta*=1-h.dampingFactor,p.phi*=1-h.dampingFactor):p.set(0,0,0),(d.distanceToSquared(h.object.position)>u||8*(1-c.dot(h.object.quaternion))>u)&&(h.dispatchEvent(E),d.copy(h.object.position),c.copy(h.object.quaternion),!0)}}(),window.addEventListener("orientationchange",s,!1),window.addEventListener("deviceorientation",c,!1),document.addEventListener("mousemove",a,!1),document.addEventListener("touchstart",r,!1),document.addEventListener("touchend",d,!1),document.addEventListener("touchmove",o,!1),m.set(window.innerWidth/2,window.innerHeight/2),t(THREE.Math.degToRad(-90)),this.update({init:!0})},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),THREE.OrbitControls.prototype.constructor=THREE.OrbitControls;